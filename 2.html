<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Staff Management</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<style>
body{font-family:'Inter',sans-serif;background:#f5f7fa;margin:0;padding:20px;}
h2{text-align:center;color:#1a73e8;}
table{width:90%;margin:20px auto;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
th,td{padding:12px 15px;text-align:left;border-bottom:1px solid #ddd;}
th{background:#1a73e8;color:#fff;}
button{padding:5px 10px;border:none;border-radius:5px;background:#1a73e8;color:#fff;cursor:pointer;}
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;}
.modal-box{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:700px;max-height:90%;overflow:auto;}
.tabs{display:flex;margin-bottom:10px;}
.tab{flex:1;text-align:center;padding:10px;background:#e0e7ff;cursor:pointer;}
.tab.active{background:#1a73e8;color:#fff;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.tab-content label{display:block;margin-top:8px;font-weight:600;}
.tab-content input{width:100%;padding:6px;border:1px solid #ccc;border-radius:4px;}
.photo-box{width:100px;height:100px;border:1px solid #ccc;border-radius:6px;object-fit:cover;display:block;margin-top:5px;}
.navigation{text-align:center;margin-top:10px;}
.navigation button{margin:5px;}
.alert{position:fixed;top:20px;right:20px;background:#4caf50;color:#fff;padding:10px 20px;border-radius:5px;display:none;}
.progress-bar {
  width: 100%;
  height: 8px;
  background-color: #e5e7eb; /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 15px;
}
.progress {
  width: 0%;
  height: 100%;
  background-color: #1a73e8; /* Ø£Ø²Ø±Ù‚ */
  transition: width 0.4s ease;
}


.photo-box {
  width: 120px;
  height: 120px;
  margin: 0 auto 10px;
  border-radius: 50%;
  background: #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #6b7280;
  background-size: cover;
  background-position: center;
  border: 2px dashed #d1d5db;
}
/* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© */
.spinner-overlay {
  display: none;             /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
}

/* Ø´ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† */
.spinner {
  border: 6px solid #e5e7eb;     /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ Ø§Ù„ÙØ§ØªØ­ */
  border-top: 6px solid #1a73e8; /* Ø§Ù„Ø£Ø²Ø±Ù‚ */
  border-radius: 50%;
  width: 60px; height: 60px;
  animation: spin 1s linear infinite;
}

/* Ø§Ù„Ø­Ø±ÙƒØ© */
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.alert {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #ff5757;
  color: #fff;
  padding: 15px 25px;
  border-radius: 8px;
  display: none;
  font-size: 16px;
  font-weight: bold;
  z-index: 9999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  text-align: center;
}

</style>
</head>
<body>
<h2>Staff Table</h2>
<input type="text" id="searchInput" placeholder="ğŸ” Search by name, staff number, or designation..." 
style="display:block;margin:0 auto 15px;padding:8px 12px;width:60%;max-width:350px;
border-radius:6px;border:1px solid #ccc;font-size:14px;">

<table id="staffTable">
<thead>
<tr><th>#</th><th>Name</th><th>Staff Number</th><th>Email</th><th>Designation</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>
<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loadingSpinner" class="spinner-overlay">
  <div class="spinner"></div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box">
    <h3>Edit Staff</h3>
        <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>   
    <div class="tabs">
      <div class="tab active" onclick="showTab(0)">Basic</div>
      <div class="tab" onclick="showTab(1)">Contact</div>
      <div class="tab" onclick="showTab(2)">Employment</div>
      <div class="tab" onclick="showTab(3)">Courses</div>
    </div>
    <form id="multiTabForm">
      <input type="hidden" id="rowIndex">
      <!-- BASIC -->
      <div class="tab-content active">
        <label>Staff Number</label><input id="staffnumber">
        <label>Staff Name</label><input id="staffname">
        <label>Date of Birth</label><input id="dob" type="date">
        <label>Gender</label><input id="gender">

        <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù -->

      </div>
      <!-- CONTACT -->
      <div class="tab-content">
        <label>Phone</label><input id="phone">
        <label>Email</label><input id="email" type="email">
        <label>Current Address</label><input id="address">
      </div>
      <!-- EMPLOYMENT -->
      <div class="tab-content">
        <label>Designation</label><input id="designation">
        <label>Department</label><input id="department">
        <label>Date of Joining</label><input id="joining" type="date">
      </div>
      <!-- COURSES -->
      <div class="tab-content">
        <label>BLS Date</label><input id="blsdate" type="date">
        <label>PALS Date</label><input id="palsdate" type="date">
      </div>
      <div class="navigation">
  <button type="button" id="cancelBtn">Cancel</button>
        <button type="button" onclick="nextPrev(-1)">Previous</button>
        <button type="button" onclick="nextPrev(1)">Next</button>
        <button type="submit">Save</button>
      </div>
    </form>
  </div>
</div>

<div class="alert" id="alertBox">Saved successfully</div>


<script>
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbxbdZcj8izCsHAn02m_jkQNy_8bWw7eH3NvsD85_Tz6YA0US6rNFvUIcaKGs5QyHF4/exec';
let rows=[],currentTab=0,currentPhotoData='';

function formatDateForInput(val){
  if(!val) return '';
  if(typeof val==='number'){
    const d=new Date((val-25569)*86400*1000);
    return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,10);
  }
  const parsed=new Date(val);
  if(!isNaN(parsed)) return new Date(parsed.getTime()-parsed.getTimezoneOffset()*60000).toISOString().slice(0,10);
  return '';
}

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù€ spinner
function toggleSpinner(show){
  const spinner=document.getElementById('loadingSpinner');
  spinner.style.display=show?'flex':'none';
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
function loadStaff(){
  toggleSpinner(true);
  fetch(SCRIPT_URL)
    .then(r=>r.json())
    .then(data=>{
      rows=data;
      const tbody=document.querySelector('#staffTable tbody');
      tbody.innerHTML='';
      data.slice(1).forEach((row,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td>
          <td>${row[1]}</td>
          <td>${row[0]}</td>
          <td>${row[11]}</td>
          <td>${row[22]}</td>
          <td><button onclick="editStaff(${i+1})">Edit</button></td>`;
        tbody.appendChild(tr);
      });
    })
    .finally(()=>toggleSpinner(false));
}

// ØªØ­Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸Ù
function editStaff(idx){
  const v=rows[idx];
  rowIndex.value=idx+1;
  staffnumber.value=v[0]||''; 
  staffname.value=v[1]||''; 
  dob.value=formatDateForInput(v[2]); 
  gender.value=v[4]||'';
  phone.value=v[9]||''; 
  email.value=v[11]||''; 
  address.value=v[12]||''; 
  designation.value=v[22]||''; 
  department.value=v[24]||'';
  joining.value=formatDateForInput(v[18]); 
  blsdate.value=formatDateForInput(v[40]); 
  palsdate.value=formatDateForInput(v[41]);




  modalOverlay.style.display='flex'; 
  showTab(0);
}


function showTab(n){
  const tabs=document.querySelectorAll('.tab');
  const contents=document.querySelectorAll('.tab-content');
  const progress=document.getElementById('progress');

  tabs.forEach(t=>t.classList.remove('active'));
  contents.forEach(c=>c.classList.remove('active'));
  tabs[n].classList.add('active');
  contents[n].classList.add('active');
  currentTab=n;

  const percentage=((n+1)/contents.length)*100;
  progress.style.width=percentage+'%';
}

function nextPrev(n){
  const newTab=currentTab+n;
  if(newTab<0||newTab>=document.querySelectorAll('.tab-content').length) return;
  showTab(newTab);
}

multiTabForm.addEventListener('submit',e=>{
  e.preventDefault();
  const idx=rowIndex.value;
  const updated=[
    staffnumber.value,
    staffname.value,
    dob.value,
    gender.value,
    phone.value,
    email.value,
    address.value,
    designation.value,
    department.value,
    joining.value,
    blsdate.value,
    palsdate.value
  ];
  toggleSpinner(true);
  fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({index:idx,values:updated})})
    .then(()=>{
      modalOverlay.style.display='none';
      showAlert();
      loadStaff();
    })
    .finally(()=>toggleSpinner(false));
});

function showAlert(){
  alertBox.style.display='block';
  setTimeout(()=>alertBox.style.display='none',3000);
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
loadStaff();

// Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
const cancelBtn=document.getElementById('cancelBtn');
cancelBtn.addEventListener('click',()=>{
  modalOverlay.style.display='none';
  multiTabForm.reset();
  currentTab=0;
  showTab(currentTab);
});
</script>

</body>
<script>
// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠØ©
const searchInput = document.getElementById('searchInput');

searchInput.addEventListener('input', function () {
  const term = this.value.toLowerCase();
  const tbody = document.querySelector('#staffTable tbody');
  const rowsTbody = tbody.querySelectorAll('tr');

  rowsTbody.forEach(row => {
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù†ØµÙŠØ© Ù„Ù„ØµÙ
    const text = row.innerText.toLowerCase();
    row.style.display = text.includes(term) ? '' : 'none';
  });
});
</script>

</html>
